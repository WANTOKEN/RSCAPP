<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="">

		<link rel="shortcut icon" href="img/favicon_1.ico">

		<title>订单中心</title>


		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-reset.css" rel="stylesheet">

		<!--Animation css-->
		<link href="css/animate.css" rel="stylesheet">

		<!--Icon-fonts css-->
		<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
		<link href="assets/ionicon/css/ionicons.min.css" rel="stylesheet" />

		<!-- DataTables -->
		<link href="assets/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
		<link href="assets/sweet-alert/sweet-alert.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="css/style.css" rel="stylesheet">
		<link href="css/helper.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet" />

	</head>

	<body>

		<!-- Aside Start-->
		<aside class="left-panel">

			<!-- brand -->
			<div class="logo">
				<a href="index.html" class="logo-expanded">
					<img src="img/single-logo.png" alt="logo">
					<span class="nav-label">RSC系统</span>
				</a>
			</div>
			<!-- / brand -->

			<!-- Navbar Start -->
			<nav class="navigation">
				<ul class="list-unstyled">
					<li class="has-submenu active">
						<a href="orders.html"><i class="ion-home"></i>
							<span class="nav-label">数据中心</a></span>
						</a>
					</li>
					<li class="has-submenu ">
						<a href="pman.html"><i class="ion-android-social-user"></i>
							<span class="nav-label">邮差中心</span></a>
					</li>
			</nav>

		</aside>
		<!-- Aside Ends-->

		<!--Main Content Start -->
		<section class="content">

			<!-- Header -->
			<header class="top-head container-fluid">
				<button type="button" class="navbar-toggle pull-left">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

				<!-- Search -->
				<form role="search" class="navbar-left app-search pull-left hidden-xs">
					<input type="text" placeholder="搜索..." class="form-control">
				</form>

				<!-- Left navbar -->
				<nav class=" navbar-default hidden-xs" role="navigation">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">Language<span class="caret"></span></a>
							<ul role="menu" class="dropdown-menu">
								<li>
									<a href="index.html#">中文简体</a>
								</li>
								<li>
									<a href="index.html#">English</a>
								</li>
							</ul>
						</li>
					</ul>
				</nav>

			</header>
			<!-- Header Ends -->
			<!-- Page Content Start -->
			<!-- ================== -->
			<div class="wraper container-fluid">
				<div class="page-title">
					<h3 class="title">订单数据</h3>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title">所有订单</h3>
							</div>
							<div class="panel-body">
								<div class="row">
									<div class="col-md-12 col-sm-12 col-xs-12">
										<table id="datatable" class="table table-striped table-bordered">
											<thead>
												<tr>
													<th style="text-align: center;">订单编号</th>
													<th style="text-align: center;">用户编号</th>
													<th style="text-align: center;">寄件地区</th>
													<th style="text-align: center;">收件地区</th>
													<th style="text-align: center;">发起时间</th>
													<th style="text-align: center;">状态</th>
													<th style="text-align: center;">操作</th>
												</tr>
											</thead>
											<tbody id="data-row" style="text-align: center;">
											</tbody>
										</table>

									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
				<!--订单详细-->
				<div id="orderdetail-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
								<h4 class="modal-title">订单详细</h4>
							</div>
							<div class="modal-body" id="orderdetail">
								<div class="row">
									<div class="col-md-5">
										<div id="code"></div>
										<p>收件操作员:&nbsp;&nbsp;{{item.pman_rid}}</p>
										<p>收件时间:&nbsp;&nbsp;{{item.rece_time}}</p>
										<p>派件操作员:&nbsp;&nbsp;{{item.pman_sid}}</p>
										<p>派件时间:&nbsp;&nbsp;{{item.send_time}}</p>
										<p>到达时间:&nbsp;&nbsp;{{item.arr_time}}</p>
									</div>
									<div class="col-md-7">
										<p>订单编号:&nbsp;&nbsp;{{item.ordernum}}</p>
										<p>订单状态:&nbsp;&nbsp;{{item.orders_status}}</p>
										<p>用户ID:&nbsp;&nbsp;{{item.user_id}}</p>
										<p>寄件人:&nbsp;&nbsp;{{item.send_name}}</p>
										<p>联系电话:&nbsp;&nbsp;{{item.send_phone}}</p>
										<p>寄件地址:&nbsp;&nbsp;{{item.begin_address}}</p>
										<p>收件人:&nbsp;&nbsp;{{item.rece_name}}</p>
										<p>联系电话:&nbsp;&nbsp;{{item.rece_phone}}</p>
										<p>物件描述:&nbsp;&nbsp;{{item.description}}</p>
										<p>收件地址:&nbsp;&nbsp;{{item.end_address}}</p>
										<p>发起时间:&nbsp;&nbsp;{{item.reg_time}}</p>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-info" data-dismiss="modal">关闭</button>
								</div>
							</div>
						</div>
					</div>
					<!-- /.modal -->

				</div>
				<!-- End Row -->
				<!--修改订单状态-->
				<div id="changeorder-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
								<h4 class="modal-title">物流状态</h4>
							</div>
							<div class="modal-body">
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="c_ordernum" class="control-label">订单编号</label>
											<input type="text" class="form-control" disabled="" id="c_ordernum">
										</div>
									</div>

								</div>
								
									<div class="row">
										<div class="col-md-4">
											<div class="form-group">
												<label for="c_status" class="control-label">物流状态:<font class="currentstatus"></font></label>
												<select class="form-control" id="c_status">
													<option value="在路上" selected="selected">开始运输</option>
													<option value="待派件">已送达</option>
												</select>
											</div>
										</div>

									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-info echange-btn">确认更改</button>
									</div>
								</div>
							</div>
						</div>
						<!-- /.modal -->

					</div>

					<!-- Footer Start -->
					<footer class="footer">
						2018 © ZTKing.
					</footer>
					<!-- Footer Ends -->

		</section>
		<!-- Main Content Ends -->

		<!-- js placed at the end of the document so the pages load faster -->
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/pace.min.js"></script>
		<script src="js/modernizr.min.js"></script>
		<script src="js/wow.min.js"></script>
		<script src="js/jquery.nicescroll.js" type="text/javascript"></script>

		<script src="assets/sweet-alert/sweet-alert.min.js"></script>
		<script src="assets/sweet-alert/sweet-alert.init.js"></script>

		<script src="js/jquery.app.js"></script>
		<!--vue.js-->
		<script src="js/vue/vue.min.js"></script>
		<script src="js/vue/vue-resource.min.js"></script>

		<script src="js/config.js"></script>
		<script src="assets/datatables/jquery.dataTables.min.js"></script>
		<script src="assets/datatables/dataTables.bootstrap.js"></script>

		<script type="text/javascript" src="js/qrcode/jquery.qrcode.min.js"></script>

		<script type="text/javascript">
			function getDatas() {
				var table;
				table = $('#datatable');
				table.dataTable({
					/*"bProcessing": true,*/
					lengthMenu: [
						[10, 25, 50, -1],
						[10, 25, 50, "全部"]
					],
					searching: true, //是否显示查询
					lengthChange: true, //是否使用下位列表选择分页大小
					//ordering:false,//全部禁止排序
					paginationType: "full_numbers", //分页按钮：有精简和全功能几种选项
					//语言国际化设置，默认是英文的
					language: {
						lengthMenu: "显示 _MENU_ 记录", //[[10, 25, 50, -1], [10, 25, 50, "All"]], //"显示 _MENU_ 记录",
						zeroRecords: "没有找到记录",
						info: "每页显示 10 条 当前显示 _START_ 到 _END_ 条，第 <span style='color:red'>_PAGE_</span> 页 ( 总共 _PAGES_ 页 ) 共 _TOTAL_ 条记录",
						infoEmpty: "没有找到记录",
						infoFiltered: "(从 _MAX_ 条记录过滤)",
						paginate: {
							first: "首页",
							previous: " 上一页",
							next: " 下一页 ",
							last: " 尾页 "
						},
						search: "模糊查询：" //查询按钮显示的文本
					},
					"ajax": {
						"url": SERVER_URL + 'getOrdersData',
						dataSrc: ""
					},
					/*"sAjaxSource": SERVER_URL + 'GoodsData',*/
					"columns": [
						{ "data": "ordernum" },
						{ "data": "user_id" },
						{ "data": "begin_area" },
						{ "data": "end_area" },
						{ "data": "reg_time" },
						{ "data": "orders_status" },
						{
							"data": null,
							"render": function(data, type, row, meta) {
								var html = '<button type="button" class="btn btn-success look" data-goodsid="' + row.ordernum + '" data-toggle="modal" data-target="#orderdetail-modal">查看详情</button>';
								html += '&nbsp;&nbsp;';
								html += '<button type="button" class="btn btn-purple change" data-goodsid="' + row.ordernum + '" data-status="' + row.orders_status + '" data-toggle="modal" data-target="#changeorder-modal">物流状态</button>';
								return html;
							}
						},
					],
					'aoColumnDefs': [{ //去掉排序
						'bSortable': false,
						'aTargets': [-1] /* 1st one, start by the right */
					}],

				});
			}
			$(document).ready(function() {
				getDatas();
			});
		</script>
		<script>
			var ordervue = new Vue({
				el: '#orderdetail',
				data: {
					item: ""
				},

			})
			//查看详情
			$(document).on("click", ".look", function() {
				var goodsid = $(this).attr('data-goodsid').toString();
				$("#code").empty();
				var str = goodsid;
				$("#code").qrcode({
					render: "table",
					width: 200,
					height: 200,
					text: str
				});
				$.ajax({
					type: "post",
					data: {
						order_num: goodsid,
					},
					url: SERVER_URL + 'getOneOrder',
					dataType: "json",
					success: function(data) {
						console.log(JSON.stringify(data));
						ordervue.item = data[0].data[0];
					}
				});
			});
			//更改
			$(document).on("click", ".change", function() {
				var goodsid = $(this).attr('data-goodsid').toString();
				console.log(goodsid);
				var status = $(this).attr('data-status').toString();
					console.log(status);
				$('#c_ordernum').val(goodsid);
				$(".currentstatus").html(status);
			});
			//确认更改
			$(document).on("click", ".echange-btn", function() {
				var goodsid = $('#c_ordernum').val();
				console.log(goodsid);
				var status = $("#c_status").val();
				console.log(status);
				if($(".currentstatus").text()=='待收件'){
					swal("还未收件，不能操作！");
					return;
				}
				if(status==null){
					swal("物流状态不能为空！");
					return;
				}
				$.ajax({
					type: "post",
					data: {
						status:status,
						ordernumber:goodsid
					},
					url: SERVER_URL + 'setOrderStatus',
					dataType: "json",
					success: function(data) {
						console.log(JSON.stringify(data));
						swal(data[0].msg);
					}
				});
			});
		</script>
	</body>

</html>